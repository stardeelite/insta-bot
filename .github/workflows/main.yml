name: Reel Bot
on:
  workflow_dispatch:
  schedule:
    - cron: '13 * * * *'  # Runs at :17, :117, etc.  (More reliable than '0')
  
jobs:
  post:
    runs-on: ubuntu-latest
    timeout-minutes: 20   # Safety: stop if it takes too long

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Random Delay (Max 5 Min)
        # $(( RANDOM % 301 )) generates 0 to 300 seconds (5 minutes)
        run: |
          OFFSET=$(( RANDOM % 301 ))
          echo "Waiting $OFFSET seconds..."
          sleep $OFFSET

      - name: Run Reel Bot
        env:
          INSTA_TOKEN: ${{ secrets.INSTA_TOKEN }}
          PHP_ENDPOINT: "https://eaglehoster1.serv00.net/filee/file_manager.php"
        run: node post_reel.js
